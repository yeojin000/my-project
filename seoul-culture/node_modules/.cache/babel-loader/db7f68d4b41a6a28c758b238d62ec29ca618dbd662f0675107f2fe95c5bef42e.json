{"ast":null,"code":"// src/lib/seoulApi.js\n// 전체 데이터를 페이지 단위로 모두 불러오는 헬퍼\n// - JSON 포맷 기준\n// - .env의 REACT_APP_SEOUL_KEY 사용(직접 호출) 또는 프록시(/api/seoul) 둘 다 지원\n\nconst DEFAULT_PAGE = 200;\nexport async function fetchSeoulAllEventsJSON({\n  // direct 모드: openapi 직접 호출\n  seoulKey = (process.env.REACT_APP_SEOUL_KEY || \"\").trim(),\n  // proxy 모드: 개발 프록시(setupProxy.js)로 키를 숨겨서 호출(ex. /api/seoul/…)\n  useProxy = false,\n  // 한 번에 가져올 개수 (200 추천)\n  pageSize = DEFAULT_PAGE,\n  // 안전 상한(너무 크면 브라우저 부담) — 필요시 늘려도 됨\n  hardLimit = 5000,\n  // 중간 진행상황 콜백 (선택)\n  onPage = null,\n  // fetch 옵션 -> abortSignal 등\n  signal = undefined\n}) {\n  const allRows = [];\n  const seen = new Set(); // SVCID 중복 제거용\n\n  let start = 1;\n  let round = 0;\n  while (allRows.length < hardLimit) {\n    var _json$culturalEventIn;\n    const end = start + pageSize - 1;\n    const url = useProxy\n    // 프록시 모드(키는 서버에서 주입): /api/seoul/culturalEventInfo/{start}/{end}/\n    ? `/api/seoul/culturalEventInfo/${start}/${end}/`\n    // 직접 호출 모드: http://openapi.seoul.go.kr:8088/{key}/json/culturalEventInfo/{start}/{end}/\n    : `http://openapi.seoul.go.kr:8088/${encodeURIComponent(seoulKey)}/json/culturalEventInfo/${start}/${end}/`;\n    const res = await fetch(url, {\n      cache: \"no-store\",\n      signal\n    });\n    if (!res.ok) throw new Error(`HTTP ${res.status} @ ${url}`);\n    const json = await res.json();\n    const rows = (json === null || json === void 0 ? void 0 : (_json$culturalEventIn = json.culturalEventInfo) === null || _json$culturalEventIn === void 0 ? void 0 : _json$culturalEventIn.row) || [];\n    if (!rows.length) break;\n    for (const r of rows) {\n      const id = r.SVCID || `${start}-${Math.random().toString(36).slice(2, 8)}`;\n      if (seen.has(id)) continue;\n      seen.add(id);\n      allRows.push(r);\n      if (allRows.length >= hardLimit) break;\n    }\n    round += 1;\n    if (typeof onPage === \"function\") {\n      onPage({\n        round,\n        fetched: rows.length,\n        total: allRows.length,\n        start,\n        end\n      });\n    }\n    if (rows.length < pageSize) break; // 마지막 페이지\n    start += pageSize;\n  }\n  return allRows;\n}","map":{"version":3,"names":["DEFAULT_PAGE","fetchSeoulAllEventsJSON","seoulKey","process","env","REACT_APP_SEOUL_KEY","trim","useProxy","pageSize","hardLimit","onPage","signal","undefined","allRows","seen","Set","start","round","length","_json$culturalEventIn","end","url","encodeURIComponent","res","fetch","cache","ok","Error","status","json","rows","culturalEventInfo","row","r","id","SVCID","Math","random","toString","slice","has","add","push","fetched","total"],"sources":["C:/my-project/seoul-culture/src/lib/seoulApi.js"],"sourcesContent":["// src/lib/seoulApi.js\r\n// 전체 데이터를 페이지 단위로 모두 불러오는 헬퍼\r\n// - JSON 포맷 기준\r\n// - .env의 REACT_APP_SEOUL_KEY 사용(직접 호출) 또는 프록시(/api/seoul) 둘 다 지원\r\n\r\nconst DEFAULT_PAGE = 200;\r\n\r\nexport async function fetchSeoulAllEventsJSON({\r\n  // direct 모드: openapi 직접 호출\r\n  seoulKey = (process.env.REACT_APP_SEOUL_KEY || \"\").trim(),\r\n  // proxy 모드: 개발 프록시(setupProxy.js)로 키를 숨겨서 호출(ex. /api/seoul/…)\r\n  useProxy = false,\r\n  // 한 번에 가져올 개수 (200 추천)\r\n  pageSize = DEFAULT_PAGE,\r\n  // 안전 상한(너무 크면 브라우저 부담) — 필요시 늘려도 됨\r\n  hardLimit = 5000,\r\n  // 중간 진행상황 콜백 (선택)\r\n  onPage = null,\r\n  // fetch 옵션 -> abortSignal 등\r\n  signal = undefined,\r\n}) {\r\n  const allRows = [];\r\n  const seen = new Set(); // SVCID 중복 제거용\r\n\r\n  let start = 1;\r\n  let round = 0;\r\n\r\n  while (allRows.length < hardLimit) {\r\n    const end = start + pageSize - 1;\r\n\r\n    const url = useProxy\r\n      // 프록시 모드(키는 서버에서 주입): /api/seoul/culturalEventInfo/{start}/{end}/\r\n      ? `/api/seoul/culturalEventInfo/${start}/${end}/`\r\n      // 직접 호출 모드: http://openapi.seoul.go.kr:8088/{key}/json/culturalEventInfo/{start}/{end}/\r\n      : `http://openapi.seoul.go.kr:8088/${encodeURIComponent(\r\n          seoulKey\r\n        )}/json/culturalEventInfo/${start}/${end}/`;\r\n\r\n    const res = await fetch(url, { cache: \"no-store\", signal });\r\n    if (!res.ok) throw new Error(`HTTP ${res.status} @ ${url}`);\r\n    const json = await res.json();\r\n\r\n    const rows = json?.culturalEventInfo?.row || [];\r\n    if (!rows.length) break;\r\n\r\n    for (const r of rows) {\r\n      const id = r.SVCID || `${start}-${Math.random().toString(36).slice(2, 8)}`;\r\n      if (seen.has(id)) continue;\r\n      seen.add(id);\r\n      allRows.push(r);\r\n      if (allRows.length >= hardLimit) break;\r\n    }\r\n\r\n    round += 1;\r\n    if (typeof onPage === \"function\") {\r\n      onPage({ round, fetched: rows.length, total: allRows.length, start, end });\r\n    }\r\n\r\n    if (rows.length < pageSize) break; // 마지막 페이지\r\n    start += pageSize;\r\n  }\r\n\r\n  return allRows;\r\n}\r\n"],"mappings":"AAAA;AACA;AACA;AACA;;AAEA,MAAMA,YAAY,GAAG,GAAG;AAExB,OAAO,eAAeC,uBAAuBA,CAAC;EAC5C;EACAC,QAAQ,GAAG,CAACC,OAAO,CAACC,GAAG,CAACC,mBAAmB,IAAI,EAAE,EAAEC,IAAI,CAAC,CAAC;EACzD;EACAC,QAAQ,GAAG,KAAK;EAChB;EACAC,QAAQ,GAAGR,YAAY;EACvB;EACAS,SAAS,GAAG,IAAI;EAChB;EACAC,MAAM,GAAG,IAAI;EACb;EACAC,MAAM,GAAGC;AACX,CAAC,EAAE;EACD,MAAMC,OAAO,GAAG,EAAE;EAClB,MAAMC,IAAI,GAAG,IAAIC,GAAG,CAAC,CAAC,CAAC,CAAC;;EAExB,IAAIC,KAAK,GAAG,CAAC;EACb,IAAIC,KAAK,GAAG,CAAC;EAEb,OAAOJ,OAAO,CAACK,MAAM,GAAGT,SAAS,EAAE;IAAA,IAAAU,qBAAA;IACjC,MAAMC,GAAG,GAAGJ,KAAK,GAAGR,QAAQ,GAAG,CAAC;IAEhC,MAAMa,GAAG,GAAGd;IACV;IAAA,EACE,gCAAgCS,KAAK,IAAII,GAAG;IAC9C;IAAA,EACE,mCAAmCE,kBAAkB,CACnDpB,QACF,CAAC,2BAA2Bc,KAAK,IAAII,GAAG,GAAG;IAE/C,MAAMG,GAAG,GAAG,MAAMC,KAAK,CAACH,GAAG,EAAE;MAAEI,KAAK,EAAE,UAAU;MAAEd;IAAO,CAAC,CAAC;IAC3D,IAAI,CAACY,GAAG,CAACG,EAAE,EAAE,MAAM,IAAIC,KAAK,CAAC,QAAQJ,GAAG,CAACK,MAAM,MAAMP,GAAG,EAAE,CAAC;IAC3D,MAAMQ,IAAI,GAAG,MAAMN,GAAG,CAACM,IAAI,CAAC,CAAC;IAE7B,MAAMC,IAAI,GAAG,CAAAD,IAAI,aAAJA,IAAI,wBAAAV,qBAAA,GAAJU,IAAI,CAAEE,iBAAiB,cAAAZ,qBAAA,uBAAvBA,qBAAA,CAAyBa,GAAG,KAAI,EAAE;IAC/C,IAAI,CAACF,IAAI,CAACZ,MAAM,EAAE;IAElB,KAAK,MAAMe,CAAC,IAAIH,IAAI,EAAE;MACpB,MAAMI,EAAE,GAAGD,CAAC,CAACE,KAAK,IAAI,GAAGnB,KAAK,IAAIoB,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE;MAC1E,IAAIzB,IAAI,CAAC0B,GAAG,CAACN,EAAE,CAAC,EAAE;MAClBpB,IAAI,CAAC2B,GAAG,CAACP,EAAE,CAAC;MACZrB,OAAO,CAAC6B,IAAI,CAACT,CAAC,CAAC;MACf,IAAIpB,OAAO,CAACK,MAAM,IAAIT,SAAS,EAAE;IACnC;IAEAQ,KAAK,IAAI,CAAC;IACV,IAAI,OAAOP,MAAM,KAAK,UAAU,EAAE;MAChCA,MAAM,CAAC;QAAEO,KAAK;QAAE0B,OAAO,EAAEb,IAAI,CAACZ,MAAM;QAAE0B,KAAK,EAAE/B,OAAO,CAACK,MAAM;QAAEF,KAAK;QAAEI;MAAI,CAAC,CAAC;IAC5E;IAEA,IAAIU,IAAI,CAACZ,MAAM,GAAGV,QAAQ,EAAE,MAAM,CAAC;IACnCQ,KAAK,IAAIR,QAAQ;EACnB;EAEA,OAAOK,OAAO;AAChB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}