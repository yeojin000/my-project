{"ast":null,"code":"var _jsxFileName = \"C:\\\\my-project\\\\seoul-culture\\\\src\\\\pages\\\\Map.jsx\",\n  _s = $RefreshSig$();\n// src/pages/Map.jsx\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\n\n/* === ÌôòÍ≤ΩÎ≥ÄÏàò === */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SEOUL_KEY = (process.env.REACT_APP_SEOUL_KEY || \"\").trim();\nconst KAKAO_KEY = (process.env.REACT_APP_KAKAO_MAP_KEY || \"\").trim();\n\n/* === ÌïÑÌÑ∞ ÏòµÏÖò === */\nconst CATEGORIES = [\"Ï†ÑÏ≤¥\", \"Í≥µÏó∞\", \"Ï†ÑÏãú\", \"ÍµêÏú°/Ï≤¥Ìóò\", \"Í∏∞ÌÉÄ\"];\nconst AREAS = [\"Ï†ÑÏ≤¥\", \"Ï¢ÖÎ°úÍµ¨\", \"Ï§ëÍµ¨\", \"Ïö©ÏÇ∞Íµ¨\", \"ÏÑ±ÎèôÍµ¨\", \"Í¥ëÏßÑÍµ¨\", \"ÎèôÎåÄÎ¨∏Íµ¨\", \"Ï§ëÎûëÍµ¨\", \"ÏÑ±Î∂ÅÍµ¨\", \"Í∞ïÎ∂ÅÍµ¨\", \"ÎèÑÎ¥âÍµ¨\", \"ÎÖ∏ÏõêÍµ¨\", \"ÏùÄÌèâÍµ¨\", \"ÏÑúÎåÄÎ¨∏Íµ¨\", \"ÎßàÌè¨Íµ¨\", \"ÏñëÏ≤úÍµ¨\", \"Í∞ïÏÑúÍµ¨\", \"Íµ¨Î°úÍµ¨\", \"Í∏àÏ≤úÍµ¨\", \"ÏòÅÎì±Ìè¨Íµ¨\", \"ÎèôÏûëÍµ¨\", \"Í¥ÄÏïÖÍµ¨\", \"ÏÑúÏ¥àÍµ¨\", \"Í∞ïÎÇ®Íµ¨\", \"ÏÜ°ÌååÍµ¨\", \"Í∞ïÎèôÍµ¨\"];\nconst QUICK_RANGES = [\"Ïò§Îäò\", \"Ïù¥Î≤à Ï£º\", \"Ïù¥Î≤à Îã¨\"];\n\n/* === ÏÑúÏö∏Ïãú ÌñâÏ†ïÍµ¨ Ï§ëÏã¨ Ï¢åÌëú(ÎåÄÎûµ) === */\nconst GU_CENTER = {\n  Ï¢ÖÎ°úÍµ¨: [37.5730, 126.9794],\n  Ï§ëÍµ¨: [37.5636, 126.9976],\n  Ïö©ÏÇ∞Íµ¨: [37.5326, 126.9905],\n  ÏÑ±ÎèôÍµ¨: [37.5636, 127.0364],\n  Í¥ëÏßÑÍµ¨: [37.5386, 127.0822],\n  ÎèôÎåÄÎ¨∏Íµ¨: [37.5744, 127.0396],\n  Ï§ëÎûëÍµ¨: [37.6060, 127.0929],\n  ÏÑ±Î∂ÅÍµ¨: [37.5894, 127.0167],\n  Í∞ïÎ∂ÅÍµ¨: [37.6396, 127.0257],\n  ÎèÑÎ¥âÍµ¨: [37.6688, 127.0471],\n  ÎÖ∏ÏõêÍµ¨: [37.6542, 127.0568],\n  ÏùÄÌèâÍµ¨: [37.6176, 126.9227],\n  ÏÑúÎåÄÎ¨∏Íµ¨: [37.5791, 126.9368],\n  ÎßàÌè¨Íµ¨: [37.5665, 126.9018],\n  ÏñëÏ≤úÍµ¨: [37.5169, 126.8665],\n  Í∞ïÏÑúÍµ¨: [37.5510, 126.8495],\n  Íµ¨Î°úÍµ¨: [37.4954, 126.8874],\n  Í∏àÏ≤úÍµ¨: [37.4599, 126.9001],\n  ÏòÅÎì±Ìè¨Íµ¨: [37.5263, 126.8963],\n  ÎèôÏûëÍµ¨: [37.5124, 126.9393],\n  Í¥ÄÏïÖÍµ¨: [37.4784, 126.9516],\n  ÏÑúÏ¥àÍµ¨: [37.4836, 127.0326],\n  Í∞ïÎÇ®Íµ¨: [37.5173, 127.0473],\n  ÏÜ°ÌååÍµ¨: [37.5112, 127.0980],\n  Í∞ïÎèôÍµ¨: [37.5301, 127.1238]\n};\n\n/* === Ï¶êÍ≤®Ï∞æÍ∏∞ Ïú†Ìã∏(localStorage) === */\nconst LS_FAV = \"sn_favorites\";\nconst loadFavs = () => {\n  try {\n    return JSON.parse(localStorage.getItem(LS_FAV) || \"[]\");\n  } catch {\n    return [];\n  }\n};\nconst saveFavs = list => localStorage.setItem(LS_FAV, JSON.stringify(list));\nconst isFav = id => loadFavs().some(x => x.id === id);\nconst toggleFav = item => {\n  const cur = loadFavs();\n  const exists = cur.some(x => x.id === item.id);\n  const next = exists ? cur.filter(x => x.id !== item.id) : [...cur, item];\n  saveFavs(next);\n  return next;\n};\n\n/* === Kakao SDK Î°úÎçî (.env ÌÇ§ ÏÇ¨Ïö©) === */\nconst loadKakao = () => new Promise((resolve, reject) => {\n  if (window.kakao && window.kakao.maps) {\n    resolve(window.kakao);\n    return;\n  }\n  const key = KAKAO_KEY;\n  if (!key) return reject(new Error(\"REACT_APP_KAKAO_MAP_KEYÍ∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§ (.env ÌôïÏù∏).\"));\n  const ID = \"kakao-maps-sdk\";\n  const exist = document.getElementById(ID);\n  const onLoaded = () => {\n    try {\n      window.kakao.maps.load(() => resolve(window.kakao));\n    } catch (e) {\n      reject(e);\n    }\n  };\n  if (exist) {\n    exist.addEventListener(\"load\", onLoaded, {\n      once: true\n    });\n    exist.addEventListener(\"error\", reject, {\n      once: true\n    });\n    return;\n  }\n  const s = document.createElement(\"script\");\n  s.id = ID;\n  s.async = true;\n  s.src = `https://dapi.kakao.com/v2/maps/sdk.js?appkey=${encodeURIComponent(key)}&libraries=services,clusterer,drawing&autoload=false`;\n  s.onload = onLoaded;\n  s.onerror = reject;\n  document.head.appendChild(s);\n});\n\n/* === ÏÑúÏö∏Ïãú Î¨∏ÌôîÌñâÏÇ¨ OpenAPI(JSON) === */\nconst PAGE_SIZE = 200;\nconst SEOUL_API_BASE = SEOUL_KEY ? `https://openapi.seoul.go.kr:8088/${encodeURIComponent(SEOUL_KEY)}/json/culturalEventInfo` : null;\n\n/* === ÏÉÅÏúÑ Ïπ¥ÌÖåÍ≥†Î¶¨ Îß§Ìïë === */\nfunction toHighLevelCategory(codename = \"\", themecode = \"\") {\n  const c = String(codename);\n  if ([\"ÏΩòÏÑúÌä∏\", \"ÌÅ¥ÎûòÏãù\", \"Íµ≠ÏïÖ\", \"Î¨¥Ïö©\", \"Ïó∞Í∑π\", \"ÎÆ§ÏßÄÏª¨/Ïò§ÌéòÎùº\", \"Ï∂ïÏ†ú-Í∏∞ÌÉÄ\"].some(k => c.includes(k))) return \"Í≥µÏó∞\";\n  if (c.includes(\"Ï†ÑÏãú/ÎØ∏Ïà†\")) return \"Ï†ÑÏãú\";\n  if (c.includes(\"ÍµêÏú°/Ï≤¥Ìóò\") || String(themecode).includes(\"ÍµêÏú°\")) return \"ÍµêÏú°/Ï≤¥Ìóò\";\n  return \"Í∏∞ÌÉÄ\";\n}\n\n/* === ÎÇ†Ïßú Ïú†Ìã∏ === */\nconst ymd = d => {\n  const y = d.getFullYear();\n  const m = String(d.getMonth() + 1).padStart(2, \"0\");\n  const day = String(d.getDate()).padStart(2, \"0\");\n  return `${y}-${m}-${day}`;\n};\nconst parseToDate = (s = \"\") => {\n  if (!s) return null;\n  const raw = String(s).trim();\n  if (/^\\d{8}$/.test(raw)) {\n    const y = raw.slice(0, 4),\n      m = raw.slice(4, 6),\n      d = raw.slice(6, 8);\n    const dt = new Date(`${y}-${m}-${d}T00:00:00`);\n    return isNaN(dt) ? null : dt;\n  }\n  const normalized = raw.replaceAll(\".\", \"-\");\n  const dt = new Date(normalized);\n  return isNaN(dt) ? null : dt;\n};\nconst normalizeRangeLabel = (s = \"\", e = \"\") => {\n  const S = (s || \"\").replaceAll(\".\", \"-\");\n  const E = (e || \"\").replaceAll(\".\", \"-\");\n  if (!S && !E) return \"ÏùºÏ†ï ÎØ∏Ï†ï\";\n  if (S && E) return `${S} ~ ${E}`;\n  return S || E;\n};\n\n/* === API ‚Üí Ïï±Ïö© Ïù¥Î≤§Ìä∏ Ï†ïÍ∑úÌôî(Ï¢åÌëúÎäî ÎÇòÏ§ëÏóê Ï±ÑÏõÄ) === */\nfunction normalizeEvents(json) {\n  var _json$culturalEventIn;\n  const rows = (json === null || json === void 0 ? void 0 : (_json$culturalEventIn = json.culturalEventInfo) === null || _json$culturalEventIn === void 0 ? void 0 : _json$culturalEventIn.row) || [];\n  return rows.map((r, idx) => {\n    const startStr = r.STRTDATE || r.DATE;\n    const endStr = r.END_DATE || r.ENDDATE || r.END;\n    const start = parseToDate(startStr);\n    const end = parseToDate(endStr) || start;\n    const category = toHighLevelCategory(r.CODENAME, r.THEMECODE);\n    return {\n      id: r.SVCID || `evt_${idx}`,\n      title: r.TITLE || r.SVCNM || \"Î¨¥Ï†ú\",\n      category,\n      place: r.PLACE || \"\",\n      gu: r.GUNAME || \"\",\n      dateStart: start ? ymd(start) : \"\",\n      dateEnd: end ? ymd(end) : \"\",\n      dateLabel: normalizeRangeLabel(startStr, endStr),\n      homepage: r.ORG_LINK || r.HMPG_ADDR || \"\",\n      fee: r.USE_FEE || \"\",\n      lat: null,\n      lng: null\n    };\n  });\n}\n\n/* === Ï¢åÌëú Ï∫êÏãú(localStorage) === */\nconst LS_GEO = \"sn_geo_cache_v1\";\nconst loadGeoCache = () => {\n  try {\n    return JSON.parse(localStorage.getItem(LS_GEO) || \"{}\");\n  } catch {\n    return {};\n  }\n};\nconst saveGeoCache = obj => localStorage.setItem(LS_GEO, JSON.stringify(obj));\n\n/* === ÎÇ†Ïßú ÌïÑÌÑ∞ === */\nconst inRange = (ev, startISO, endISO) => {\n  if (!startISO && !endISO) return true;\n  const s = ev.dateStart ? new Date(ev.dateStart + \"T00:00:00\") : null;\n  const e = ev.dateEnd ? new Date(ev.dateEnd + \"T23:59:59\") : s;\n  const S = startISO ? new Date(startISO + \"T00:00:00\") : null;\n  const E = endISO ? new Date(endISO + \"T23:59:59\") : null;\n  if (!s || !e) return false;\n  const leftOK = !E || s <= E;\n  const rightOK = !S || e >= S;\n  return leftOK && rightOK;\n};\n\n// ÏÑúÏö∏Ïãú ÎåÄÎûµÏ†ÅÏù∏ Í≤ΩÍ≥Ñ (ÏßÄÏò§ÏΩîÎî© Í≤∞Í≥º ÌïÑÌÑ∞ÎßÅÏö©)\nconst isWithinSeoulBoundary = (lat, lng) => {\n  return lat >= 37.4 && lat <= 37.7 && lng >= 126.7 && lng <= 127.2;\n};\nexport default function MapPage() {\n  _s();\n  /* ÌïÑÌÑ∞ ÏÉÅÌÉú */\n  const [category, setCategory] = useState(\"Ï†ÑÏ≤¥\");\n  const [area, setArea] = useState(\"Ï†ÑÏ≤¥\");\n  const [quick, setQuick] = useState(\"Ïò§Îäò\");\n  const [startDate, setStartDate] = useState(ymd(new Date())); // Í∏∞Î≥∏: Ïò§Îäò\n  const [endDate, setEndDate] = useState(\"\");\n\n  /* Îç∞Ïù¥ÌÑ∞/ÏßÄÎèÑ ÏÉÅÌÉú */\n  const [events, setEvents] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [err, setErr] = useState(null);\n  const [selected, setSelected] = useState(null);\n  const mapEl = useRef(null);\n  const mapRef = useRef(null);\n  const markersRef = useRef([]);\n  const infoRef = useRef([]);\n  const clusterRef = useRef(null);\n  const kakaoRef = useRef(null);\n\n  /* Kakao + Îç∞Ïù¥ÌÑ∞ Î°úÎìú */\n  useEffect(() => {\n    let disposed = false;\n    (async () => {\n      try {\n        const kakao = await loadKakao();\n        if (disposed) return;\n        kakaoRef.current = kakao;\n        const center = new kakao.maps.LatLng(37.5665, 126.9780);\n        if (mapEl.current) {\n          const map = new kakao.maps.Map(mapEl.current, {\n            center,\n            level: 7\n          });\n          mapRef.current = map;\n        }\n        setLoading(true);\n        setErr(null);\n        if (!SEOUL_API_BASE) {\n          throw new Error(\"REACT_APP_SEOUL_KEYÍ∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§ (.env ÌôïÏù∏).\");\n        }\n        const userStartISO = startDate || ymd(new Date());\n        const userStart = new Date(userStartISO + \"T00:00:00\");\n        let pageStart = 1;\n        const allRows = [];\n        let stop = false;\n        while (!stop) {\n          var _json$culturalEventIn2;\n          const pageEnd = pageStart + PAGE_SIZE - 1;\n          const url = `${SEOUL_API_BASE}/${pageStart}/${pageEnd}/`;\n          const res = await fetch(url, {\n            cache: \"no-store\"\n          });\n          if (!res.ok) throw new Error(`HTTP ${res.status}`);\n          const json = await res.json();\n          const rows = (json === null || json === void 0 ? void 0 : (_json$culturalEventIn2 = json.culturalEventInfo) === null || _json$culturalEventIn2 === void 0 ? void 0 : _json$culturalEventIn2.row) || [];\n          if (rows.length === 0) break;\n          allRows.push(...rows);\n          const last = rows[rows.length - 1];\n          const endStr = last.END_DATE || last.ENDDATE || last.END || last.STRTDATE || last.DATE;\n          const lastEnd = parseToDate(endStr);\n          if (lastEnd && lastEnd < userStart) {\n            stop = true;\n          } else {\n            pageStart += PAGE_SIZE;\n          }\n          if (disposed) return;\n        }\n        const items = normalizeEvents({\n          culturalEventInfo: {\n            row: allRows\n          }\n        });\n        if (!disposed) setEvents(items);\n      } catch (e) {\n        if (!disposed) setErr(e);\n      } finally {\n        if (!disposed) setLoading(false);\n      }\n    })();\n    return () => {\n      disposed = true;\n    };\n  }, [startDate]);\n\n  /* Îπ†Î•∏ Í∏∞Í∞Ñ ÏÑ†ÌÉù */\n  useEffect(() => {\n    if (!quick) return;\n    const today = new Date();\n    if (quick === \"Ïò§Îäò\") {\n      const k = ymd(today);\n      setStartDate(k);\n      setEndDate(k);\n      return;\n    }\n    if (quick === \"Ïù¥Î≤à Ï£º\") {\n      const day = today.getDay(); // 0:Ïùº\n      const diffToMon = day === 0 ? -6 : 1 - day;\n      const mon = new Date(today);\n      mon.setDate(today.getDate() + diffToMon);\n      const sun = new Date(mon);\n      sun.setDate(mon.getDate() + 6);\n      setStartDate(ymd(mon));\n      setEndDate(ymd(sun));\n      return;\n    }\n    if (quick === \"Ïù¥Î≤à Îã¨\") {\n      const y = today.getFullYear(),\n        m = today.getMonth();\n      const s = new Date(y, m, 1);\n      const e = new Date(y, m + 1, 0);\n      setStartDate(ymd(s));\n      setEndDate(ymd(e));\n      return;\n    }\n  }, [quick]);\n\n  /* ÏßÄÏó≠ Î≥ÄÍ≤Ω ‚Üí ÏßÄÎèÑ Ï§ëÏã¨ Ïù¥Îèô */\n  useEffect(() => {\n    const kakao = kakaoRef.current;\n    const map = mapRef.current;\n    if (!kakao || !map) return;\n    if (area === \"Ï†ÑÏ≤¥\") {\n      map.setLevel(7);\n      map.setCenter(new kakao.maps.LatLng(37.5665, 126.9780));\n    } else if (GU_CENTER[area]) {\n      const [lat, lng] = GU_CENTER[area];\n      map.setLevel(5);\n      map.setCenter(new kakao.maps.LatLng(lat, lng));\n    } else {\n      const ps = new kakao.maps.services.Places();\n      ps.keywordSearch(area, (data, status) => {\n        if (status === kakao.maps.services.Status.OK && data[0]) {\n          map.setLevel(5);\n          map.setCenter(new kakao.maps.LatLng(data[0].y, data[0].x));\n        }\n      });\n    }\n  }, [area]);\n\n  /* ÌïÑÌÑ∞ÎßÅ */\n  const filtered = useMemo(() => {\n    return events.filter(e => {\n      var _e$gu, _e$place;\n      const byCat = category === \"Ï†ÑÏ≤¥\" ? true : e.category === category;\n      const byArea = area === \"Ï†ÑÏ≤¥\" ? true : ((_e$gu = e.gu) === null || _e$gu === void 0 ? void 0 : _e$gu.includes(area)) || ((_e$place = e.place) === null || _e$place === void 0 ? void 0 : _e$place.includes(area));\n      const byDate = inRange(e, startDate, endDate);\n      return byCat && byArea && byDate;\n    });\n  }, [events, category, area, startDate, endDate]);\n\n  /* Ïû•ÏÜå ‚Üí Ï¢åÌëú(ÏßÄÏò§ÏΩîÎî©) + Ï∫êÏãú */\n  const [geoReadyEvents, setGeoReadyEvents] = useState([]);\n  useEffect(() => {\n    const kakao = kakaoRef.current;\n    if (!kakao) return;\n    const cache = loadGeoCache();\n    const ps = new kakao.maps.services.Places();\n    const geocoder = new kakao.maps.services.Geocoder();\n    let cancelled = false;\n    const SEOUL_CENTER = new kakao.maps.LatLng(37.5665, 126.9780);\n    const isBadPlace = (txt = \"\") => {\n      const s = String(txt);\n      return !s.trim() || /Ïò®ÎùºÏù∏|ÎπÑÎåÄÎ©¥|Î¨¥Í¥Ä|ÎØ∏Ï†ï|ÏóÜÏùå/i.test(s);\n    };\n    const pickSeoulHit = (data, gu) => {\n      const inSeoul = data.filter(d => (d.address_name || \"\").startsWith(\"ÏÑúÏö∏\"));\n      const inGu = gu ? inSeoul.filter(d => d.address_name.includes(gu)) : inSeoul;\n      return inGu[0] || inSeoul[0] || null;\n    };\n    const fillCoords = async () => {\n      const targets = filtered.slice(0, 300);\n      const out = [];\n      for (const ev of targets) {\n        const key = `${ev.gu || \"\"}|${ev.place || \"\"}|${ev.title}`;\n        if (cache[key]) {\n          out.push({\n            ...ev,\n            ...cache[key]\n          });\n          continue;\n        }\n        let coords = null;\n\n        // 0) PLACEÍ∞Ä ÏßÄÏò§ÏΩîÎî© Î∂ÄÏ†ÅÌï©Ïù¥Î©¥ Î∞îÎ°ú Íµ¨ Ï§ëÏã¨\n        if (isBadPlace(ev.place) && GU_CENTER[ev.gu]) {\n          const [lat, lng] = GU_CENTER[ev.gu];\n          coords = {\n            lat,\n            lng\n          };\n        }\n\n        // 1) ÌÇ§ÏõåÎìú Í≤ÄÏÉâ (Íµ¨Î™Ö + Ïû•ÏÜå)\n        if (!coords && ev.place) {\n          const query = `${ev.gu ? ev.gu + \" \" : \"\"}${ev.place}`.trim();\n          coords = await new Promise(resolve => {\n            ps.keywordSearch(query, (data, status) => {\n              if (status === kakao.maps.services.Status.OK && data.length) {\n                const best = pickSeoulHit(data, ev.gu);\n                if (best) return resolve({\n                  lat: Number(best.y),\n                  lng: Number(best.x)\n                });\n              }\n              resolve(null);\n            }, {\n              location: SEOUL_CENTER,\n              radius: 60000\n            });\n          });\n        }\n\n        // 2) Ï£ºÏÜå ÏßÄÏò§ÏΩîÎî© (ÏÑúÏö∏/Íµ¨ Í≤ÄÏ¶ù)\n        if (!coords && ev.place) {\n          coords = await new Promise(resolve => {\n            geocoder.addressSearch(ev.place, (result, status) => {\n              if (status === kakao.maps.services.Status.OK && result[0]) {\n                const r = result.find(r => r.address_name.startsWith(\"ÏÑúÏö∏\") && (!ev.gu || r.address_name.includes(ev.gu))) || result[0];\n                if (r.address_name.startsWith(\"ÏÑúÏö∏\")) {\n                  return resolve({\n                    lat: Number(r.y),\n                    lng: Number(r.x)\n                  });\n                }\n              }\n              resolve(null);\n            });\n          });\n        }\n\n        // 3) ÏµúÏ¢Ö Î≥¥Í∞ï: Íµ¨ Ï§ëÏã¨\n        if (!coords && GU_CENTER[ev.gu]) {\n          const [lat, lng] = GU_CENTER[ev.gu];\n          coords = {\n            lat,\n            lng\n          };\n        }\n\n        // ÏÑúÏö∏ Í≤ΩÍ≥Ñ Í≤ÄÏ¶ù\n        if (coords) {\n          if (!isWithinSeoulBoundary(coords.lat, coords.lng)) {\n            console.warn(`[Î≤îÏúÑ Ïò§Î•ò] ÏÑúÏö∏ Î∞ñ Ï¢åÌëú Í∞êÏßÄ: ${ev.title}`, coords);\n            if (GU_CENTER[ev.gu]) {\n              const [lat, lng] = GU_CENTER[ev.gu];\n              coords = {\n                lat,\n                lng\n              };\n            } else {\n              coords = null;\n            }\n          }\n        }\n        if (coords) {\n          cache[key] = coords;\n          out.push({\n            ...ev,\n            ...coords\n          });\n        }\n        await new Promise(r => setTimeout(r, 25));\n        if (cancelled) return;\n      }\n      saveGeoCache(cache);\n      if (!cancelled) setGeoReadyEvents(out);\n    };\n    fillCoords();\n    return () => {\n      cancelled = true;\n    };\n  }, [filtered]);\n\n  /* ÎßàÏª§/ÌÅ¥Îü¨Ïä§ÌÑ∞ Í∞±Ïã† + ÏßÄÎèÑ ÌÅ¥Î¶≠ Ïãú ÌåùÏóÖ Îã´Í∏∞ */\n  useEffect(() => {\n    const kakao = kakaoRef.current;\n    const map = mapRef.current;\n    if (!kakao || !map) return;\n\n    // Í∏∞Ï°¥ ÎßàÏª§/Ïù∏Ìè¨ÏúàÎèÑÏö∞/ÌÅ¥Îü¨Ïä§ÌÑ∞ Ï†úÍ±∞\n    markersRef.current.forEach(m => m.setMap(null));\n    infoRef.current.forEach(i => i.close());\n    markersRef.current = [];\n    infoRef.current = [];\n    if (clusterRef.current) clusterRef.current.clear();\n    if (geoReadyEvents.length === 0) return;\n    const markers = [];\n    const infos = [];\n    const bounds = new kakao.maps.LatLngBounds();\n    geoReadyEvents.forEach(ev => {\n      if (ev.lat == null || ev.lng == null) return;\n      const pos = new kakao.maps.LatLng(ev.lat, ev.lng);\n      bounds.extend(pos);\n      const marker = new kakao.maps.Marker({\n        position: pos,\n        title: ev.title\n      });\n      const iwHtml = `\n        <div style=\"padding:8px 10px; font-size:12px; max-width:240px;\">\n          <div style=\"font-weight:600; margin-bottom:4px;\">${ev.title}</div>\n          <div style=\"color:#666;\">${ev.place || ev.gu || \"\"}</div>\n          <div style=\"color:#888; margin-top:2px;\">${ev.dateLabel}</div>\n        </div>\n      `;\n      const iw = new kakao.maps.InfoWindow({\n        content: iwHtml,\n        removable: true // ‚òÖ X Î≤ÑÌäº ÌëúÏãú\n      });\n      kakao.maps.event.addListener(marker, \"click\", () => {\n        infos.forEach(i => i.close());\n        iw.open(map, marker);\n        setSelected(ev);\n      });\n      markers.push(marker);\n      infos.push(iw);\n    });\n    markersRef.current = markers;\n    infoRef.current = infos;\n    const clusterer = new kakao.maps.MarkerClusterer({\n      map,\n      markers,\n      averageCenter: true,\n      minLevel: 6,\n      disableClickZoom: false\n    });\n    clusterRef.current = clusterer;\n\n    // ‚òÖ ÏßÄÎèÑ Îã§Î•∏ Î∂ÄÎ∂Ñ ÌÅ¥Î¶≠ Ïãú Î™®Îì† Î†àÏù¥Ïñ¥ ÌåùÏóÖ Îã´Í∏∞\n    const handleMapClick = () => {\n      infos.forEach(i => i.close());\n    };\n    kakao.maps.event.addListener(map, \"click\", handleMapClick);\n    if (area === \"Ï†ÑÏ≤¥\" && markers.length > 0) {\n      map.setBounds(bounds, 40, 40, 40, 40);\n    }\n    if (selected && !geoReadyEvents.some(e => e.id === selected.id)) {\n      setSelected(null);\n    }\n    return () => {\n      kakao.maps.event.removeListener(map, \"click\", handleMapClick);\n    };\n  }, [geoReadyEvents, area, selected]);\n\n  /* Ï¶êÍ≤®Ï∞æÍ∏∞ ÌÜ†Í∏Ä (ÌéòÏù¥ÏßÄ Ïù¥Îèô ÏóÜÏùå) */\n  const [, forceFav] = useState(0);\n  const onToggleFav = ev => {\n    toggleFav({\n      id: ev.id,\n      title: ev.title,\n      category: ev.category,\n      date: ev.dateLabel,\n      place: ev.place || ev.gu || \"\",\n      homepage: ev.homepage || \"\"\n    });\n    forceFav(v => v + 1);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"min-h-screen bg-white px-6 py-8 max-w-7xl mx-auto\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"grid grid-cols-1 lg:grid-cols-12 gap-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"aside\", {\n        className: \"lg:col-span-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"font-semibold mb-2\",\n          children: \"\\uCE74\\uD14C\\uACE0\\uB9AC\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 552,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          value: category,\n          onChange: e => setCategory(e.target.value),\n          className: \"border rounded px-2 py-2 w-full mb-4\",\n          children: CATEGORIES.map(c => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: c,\n            children: c\n          }, c, false, {\n            fileName: _jsxFileName,\n            lineNumber: 558,\n            columnNumber: 36\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 553,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"font-semibold mb-2\",\n          children: \"\\uC9C0\\uC5ED(\\uD589\\uC815\\uAD6C)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 561,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n          value: area,\n          onChange: e => setArea(e.target.value),\n          className: \"border rounded px-2 py-2 w-full mb-4\",\n          children: AREAS.map(a => /*#__PURE__*/_jsxDEV(\"option\", {\n            value: a,\n            children: a\n          }, a, false, {\n            fileName: _jsxFileName,\n            lineNumber: 567,\n            columnNumber: 31\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 562,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"font-semibold mb-2\",\n          children: \"\\uB0A0\\uC9DC\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 570,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"grid grid-cols-3 gap-2 mb-2\",\n          children: QUICK_RANGES.map(r => /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setQuick(r),\n            className: \"text-xs border rounded px-2 py-1 \" + (quick === r ? \"bg-black text-white\" : \"bg-white hover:bg-gray-50\"),\n            children: r\n          }, r, false, {\n            fileName: _jsxFileName,\n            lineNumber: 573,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 571,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex items-center gap-2\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"date\",\n            value: startDate,\n            onChange: e => {\n              setStartDate(e.target.value);\n              setQuick(\"\");\n            },\n            className: \"border rounded px-2 py-1 text-sm w-full\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 586,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"text-sm text-gray-500\",\n            children: \"~\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 592,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"date\",\n            value: endDate,\n            onChange: e => {\n              setEndDate(e.target.value);\n              setQuick(\"\");\n            },\n            className: \"border rounded px-2 py-1 text-sm w-full\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 593,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 585,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-4 text-xs text-gray-600\",\n          children: [loading ? \"üîÑ ÏÑúÏö∏Ïãú ÌñâÏÇ¨ Î∂àÎü¨Ïò§Îäî Ï§ë‚Ä¶\" : `ÌëúÏãú ÌõÑÎ≥¥: ${filtered.length}Í±¥`, err && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-red-600 mt-1\",\n            children: [\"\\uB370\\uC774\\uD130 \\uB85C\\uB4DC \\uC2E4\\uD328: \", String(err.message || err)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 603,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 601,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 551,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"lg:col-span-6\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: mapEl,\n          className: \"border rounded-lg w-full\",\n          style: {\n            height: 600\n          },\n          \"aria-label\": \"\\uCE74\\uCE74\\uC624 \\uC9C0\\uB3C4\",\n          role: \"region\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 609,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 608,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"aside\", {\n        className: \"lg:col-span-3 border rounded-lg p-4 bg-gray-50\",\n        children: !selected ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-gray-500 text-sm text-center mt-20\",\n          children: \"\\uC9C0\\uB3C4\\uC758 \\uB9C8\\uCEE4\\uB97C \\uD074\\uB9AD\\uD558\\uBA74 \\uC0C1\\uC138 \\uC815\\uBCF4\\uAC00 \\uD45C\\uC2DC\\uB429\\uB2C8\\uB2E4.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 621,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-xs inline-flex items-center rounded-full bg-gray-200 px-2 py-0.5 mb-2\",\n            children: [selected.category, \" \", selected.gu ? `¬∑ ${selected.gu}` : \"\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 626,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"font-bold text-lg mb-1\",\n            children: selected.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 629,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-gray-700\",\n            children: selected.place || selected.gu || \"\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 630,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-gray-700 mt-1\",\n            children: [\"\\uD83D\\uDCC5 \", selected.dateLabel]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 631,\n            columnNumber: 15\n          }, this), selected.fee && /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-xs text-gray-500 mt-1\",\n            children: [\"\\uC694\\uAE08: \", selected.fee]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 632,\n            columnNumber: 32\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-3 flex items-center gap-3\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => onToggleFav(selected),\n              className: \"text-xl\",\n              title: isFav(selected.id) ? \"Ï¶êÍ≤®Ï∞æÍ∏∞ Ìï¥Ï†ú\" : \"Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä\",\n              \"aria-label\": isFav(selected.id) ? \"Ï¶êÍ≤®Ï∞æÍ∏∞ Ìï¥Ï†ú\" : \"Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä\",\n              children: isFav(selected.id) ? \"‚ù§Ô∏è\" : \"ü§ç\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 635,\n              columnNumber: 17\n            }, this), selected.homepage && /*#__PURE__*/_jsxDEV(\"a\", {\n              href: selected.homepage,\n              target: \"_blank\",\n              rel: \"noreferrer\",\n              className: \"text-sm underline\",\n              title: \"\\uC0C1\\uC138\\uBCF4\\uAE30\",\n              children: \"\\uC0C1\\uC138\\uBCF4\\uAE30\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 644,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 634,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"mt-4 text-xs underline text-gray-600\",\n            onClick: () => setSelected(null),\n            children: \"\\uC120\\uD0DD \\uD574\\uC81C\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 656,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 625,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 619,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 549,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 548,\n    columnNumber: 5\n  }, this);\n}\n_s(MapPage, \"eBqsbbkO1xwjIUafzRar7dEbado=\");\n_c = MapPage;\nvar _c;\n$RefreshReg$(_c, \"MapPage\");","map":{"version":3,"names":["React","useEffect","useMemo","useRef","useState","jsxDEV","_jsxDEV","SEOUL_KEY","process","env","REACT_APP_SEOUL_KEY","trim","KAKAO_KEY","REACT_APP_KAKAO_MAP_KEY","CATEGORIES","AREAS","QUICK_RANGES","GU_CENTER","Ï¢ÖÎ°úÍµ¨","Ï§ëÍµ¨","Ïö©ÏÇ∞Íµ¨","ÏÑ±ÎèôÍµ¨","Í¥ëÏßÑÍµ¨","ÎèôÎåÄÎ¨∏Íµ¨","Ï§ëÎûëÍµ¨","ÏÑ±Î∂ÅÍµ¨","Í∞ïÎ∂ÅÍµ¨","ÎèÑÎ¥âÍµ¨","ÎÖ∏ÏõêÍµ¨","ÏùÄÌèâÍµ¨","ÏÑúÎåÄÎ¨∏Íµ¨","ÎßàÌè¨Íµ¨","ÏñëÏ≤úÍµ¨","Í∞ïÏÑúÍµ¨","Íµ¨Î°úÍµ¨","Í∏àÏ≤úÍµ¨","ÏòÅÎì±Ìè¨Íµ¨","ÎèôÏûëÍµ¨","Í¥ÄÏïÖÍµ¨","ÏÑúÏ¥àÍµ¨","Í∞ïÎÇ®Íµ¨","ÏÜ°ÌååÍµ¨","Í∞ïÎèôÍµ¨","LS_FAV","loadFavs","JSON","parse","localStorage","getItem","saveFavs","list","setItem","stringify","isFav","id","some","x","toggleFav","item","cur","exists","next","filter","loadKakao","Promise","resolve","reject","window","kakao","maps","key","Error","ID","exist","document","getElementById","onLoaded","load","e","addEventListener","once","s","createElement","async","src","encodeURIComponent","onload","onerror","head","appendChild","PAGE_SIZE","SEOUL_API_BASE","toHighLevelCategory","codename","themecode","c","String","k","includes","ymd","d","y","getFullYear","m","getMonth","padStart","day","getDate","parseToDate","raw","test","slice","dt","Date","isNaN","normalized","replaceAll","normalizeRangeLabel","S","E","normalizeEvents","json","_json$culturalEventIn","rows","culturalEventInfo","row","map","r","idx","startStr","STRTDATE","DATE","endStr","END_DATE","ENDDATE","END","start","end","category","CODENAME","THEMECODE","SVCID","title","TITLE","SVCNM","place","PLACE","gu","GUNAME","dateStart","dateEnd","dateLabel","homepage","ORG_LINK","HMPG_ADDR","fee","USE_FEE","lat","lng","LS_GEO","loadGeoCache","saveGeoCache","obj","inRange","ev","startISO","endISO","leftOK","rightOK","isWithinSeoulBoundary","MapPage","_s","setCategory","area","setArea","quick","setQuick","startDate","setStartDate","endDate","setEndDate","events","setEvents","loading","setLoading","err","setErr","selected","setSelected","mapEl","mapRef","markersRef","infoRef","clusterRef","kakaoRef","disposed","current","center","LatLng","Map","level","userStartISO","userStart","pageStart","allRows","stop","_json$culturalEventIn2","pageEnd","url","res","fetch","cache","ok","status","length","push","last","lastEnd","items","today","getDay","diffToMon","mon","setDate","sun","setLevel","setCenter","ps","services","Places","keywordSearch","data","Status","OK","filtered","_e$gu","_e$place","byCat","byArea","byDate","geoReadyEvents","setGeoReadyEvents","geocoder","Geocoder","cancelled","SEOUL_CENTER","isBadPlace","txt","pickSeoulHit","inSeoul","address_name","startsWith","inGu","fillCoords","targets","out","coords","query","best","Number","location","radius","addressSearch","result","find","console","warn","setTimeout","forEach","setMap","i","close","clear","markers","infos","bounds","LatLngBounds","pos","extend","marker","Marker","position","iwHtml","iw","InfoWindow","content","removable","event","addListener","open","clusterer","MarkerClusterer","averageCenter","minLevel","disableClickZoom","handleMapClick","setBounds","removeListener","forceFav","onToggleFav","date","v","className","children","fileName","_jsxFileName","lineNumber","columnNumber","value","onChange","target","a","onClick","type","message","ref","style","height","role","href","rel","_c","$RefreshReg$"],"sources":["C:/my-project/seoul-culture/src/pages/Map.jsx"],"sourcesContent":["// src/pages/Map.jsx\r\nimport React, { useEffect, useMemo, useRef, useState } from \"react\";\r\n\r\n/* === ÌôòÍ≤ΩÎ≥ÄÏàò === */\r\nconst SEOUL_KEY = (process.env.REACT_APP_SEOUL_KEY || \"\").trim();\r\nconst KAKAO_KEY = (process.env.REACT_APP_KAKAO_MAP_KEY || \"\").trim();\r\n\r\n/* === ÌïÑÌÑ∞ ÏòµÏÖò === */\r\nconst CATEGORIES = [\"Ï†ÑÏ≤¥\", \"Í≥µÏó∞\", \"Ï†ÑÏãú\", \"ÍµêÏú°/Ï≤¥Ìóò\", \"Í∏∞ÌÉÄ\"];\r\nconst AREAS = [\r\n  \"Ï†ÑÏ≤¥\", \"Ï¢ÖÎ°úÍµ¨\", \"Ï§ëÍµ¨\", \"Ïö©ÏÇ∞Íµ¨\", \"ÏÑ±ÎèôÍµ¨\", \"Í¥ëÏßÑÍµ¨\",\r\n  \"ÎèôÎåÄÎ¨∏Íµ¨\", \"Ï§ëÎûëÍµ¨\", \"ÏÑ±Î∂ÅÍµ¨\", \"Í∞ïÎ∂ÅÍµ¨\", \"ÎèÑÎ¥âÍµ¨\",\r\n  \"ÎÖ∏ÏõêÍµ¨\", \"ÏùÄÌèâÍµ¨\", \"ÏÑúÎåÄÎ¨∏Íµ¨\", \"ÎßàÌè¨Íµ¨\", \"ÏñëÏ≤úÍµ¨\",\r\n  \"Í∞ïÏÑúÍµ¨\", \"Íµ¨Î°úÍµ¨\", \"Í∏àÏ≤úÍµ¨\", \"ÏòÅÎì±Ìè¨Íµ¨\", \"ÎèôÏûëÍµ¨\",\r\n  \"Í¥ÄÏïÖÍµ¨\", \"ÏÑúÏ¥àÍµ¨\", \"Í∞ïÎÇ®Íµ¨\", \"ÏÜ°ÌååÍµ¨\", \"Í∞ïÎèôÍµ¨\"\r\n];\r\nconst QUICK_RANGES = [\"Ïò§Îäò\", \"Ïù¥Î≤à Ï£º\", \"Ïù¥Î≤à Îã¨\"];\r\n\r\n/* === ÏÑúÏö∏Ïãú ÌñâÏ†ïÍµ¨ Ï§ëÏã¨ Ï¢åÌëú(ÎåÄÎûµ) === */\r\nconst GU_CENTER = {\r\n  Ï¢ÖÎ°úÍµ¨: [37.5730, 126.9794],\r\n  Ï§ëÍµ¨: [37.5636, 126.9976],\r\n  Ïö©ÏÇ∞Íµ¨: [37.5326, 126.9905],\r\n  ÏÑ±ÎèôÍµ¨: [37.5636, 127.0364],\r\n  Í¥ëÏßÑÍµ¨: [37.5386, 127.0822],\r\n  ÎèôÎåÄÎ¨∏Íµ¨: [37.5744, 127.0396],\r\n  Ï§ëÎûëÍµ¨: [37.6060, 127.0929],\r\n  ÏÑ±Î∂ÅÍµ¨: [37.5894, 127.0167],\r\n  Í∞ïÎ∂ÅÍµ¨: [37.6396, 127.0257],\r\n  ÎèÑÎ¥âÍµ¨: [37.6688, 127.0471],\r\n  ÎÖ∏ÏõêÍµ¨: [37.6542, 127.0568],\r\n  ÏùÄÌèâÍµ¨: [37.6176, 126.9227],\r\n  ÏÑúÎåÄÎ¨∏Íµ¨: [37.5791, 126.9368],\r\n  ÎßàÌè¨Íµ¨: [37.5665, 126.9018],\r\n  ÏñëÏ≤úÍµ¨: [37.5169, 126.8665],\r\n  Í∞ïÏÑúÍµ¨: [37.5510, 126.8495],\r\n  Íµ¨Î°úÍµ¨: [37.4954, 126.8874],\r\n  Í∏àÏ≤úÍµ¨: [37.4599, 126.9001],\r\n  ÏòÅÎì±Ìè¨Íµ¨: [37.5263, 126.8963],\r\n  ÎèôÏûëÍµ¨: [37.5124, 126.9393],\r\n  Í¥ÄÏïÖÍµ¨: [37.4784, 126.9516],\r\n  ÏÑúÏ¥àÍµ¨: [37.4836, 127.0326],\r\n  Í∞ïÎÇ®Íµ¨: [37.5173, 127.0473],\r\n  ÏÜ°ÌååÍµ¨: [37.5112, 127.0980],\r\n  Í∞ïÎèôÍµ¨: [37.5301, 127.1238]\r\n};\r\n\r\n/* === Ï¶êÍ≤®Ï∞æÍ∏∞ Ïú†Ìã∏(localStorage) === */\r\nconst LS_FAV = \"sn_favorites\";\r\nconst loadFavs = () => { try { return JSON.parse(localStorage.getItem(LS_FAV) || \"[]\"); } catch { return []; } };\r\nconst saveFavs = (list) => localStorage.setItem(LS_FAV, JSON.stringify(list));\r\nconst isFav = (id) => loadFavs().some((x) => x.id === id);\r\nconst toggleFav = (item) => {\r\n  const cur = loadFavs();\r\n  const exists = cur.some((x) => x.id === item.id);\r\n  const next = exists ? cur.filter((x) => x.id !== item.id) : [...cur, item];\r\n  saveFavs(next);\r\n  return next;\r\n};\r\n\r\n/* === Kakao SDK Î°úÎçî (.env ÌÇ§ ÏÇ¨Ïö©) === */\r\nconst loadKakao = () =>\r\n  new Promise((resolve, reject) => {\r\n    if (window.kakao && window.kakao.maps) { resolve(window.kakao); return; }\r\n\r\n    const key = KAKAO_KEY;\r\n    if (!key) return reject(new Error(\"REACT_APP_KAKAO_MAP_KEYÍ∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§ (.env ÌôïÏù∏).\"));\r\n\r\n    const ID = \"kakao-maps-sdk\";\r\n    const exist = document.getElementById(ID);\r\n\r\n    const onLoaded = () => {\r\n      try { window.kakao.maps.load(() => resolve(window.kakao)); }\r\n      catch (e) { reject(e); }\r\n    };\r\n\r\n    if (exist) {\r\n      exist.addEventListener(\"load\", onLoaded, { once: true });\r\n      exist.addEventListener(\"error\", reject, { once: true });\r\n      return;\r\n    }\r\n\r\n    const s = document.createElement(\"script\");\r\n    s.id = ID;\r\n    s.async = true;\r\n    s.src = `https://dapi.kakao.com/v2/maps/sdk.js?appkey=${encodeURIComponent(key)}&libraries=services,clusterer,drawing&autoload=false`;\r\n    s.onload = onLoaded;\r\n    s.onerror = reject;\r\n    document.head.appendChild(s);\r\n  });\r\n\r\n/* === ÏÑúÏö∏Ïãú Î¨∏ÌôîÌñâÏÇ¨ OpenAPI(JSON) === */\r\nconst PAGE_SIZE = 200;\r\nconst SEOUL_API_BASE = SEOUL_KEY\r\n  ? `https://openapi.seoul.go.kr:8088/${encodeURIComponent(SEOUL_KEY)}/json/culturalEventInfo`\r\n  : null;\r\n\r\n/* === ÏÉÅÏúÑ Ïπ¥ÌÖåÍ≥†Î¶¨ Îß§Ìïë === */\r\nfunction toHighLevelCategory(codename = \"\", themecode = \"\") {\r\n  const c = String(codename);\r\n  if ([\"ÏΩòÏÑúÌä∏\", \"ÌÅ¥ÎûòÏãù\", \"Íµ≠ÏïÖ\", \"Î¨¥Ïö©\", \"Ïó∞Í∑π\", \"ÎÆ§ÏßÄÏª¨/Ïò§ÌéòÎùº\", \"Ï∂ïÏ†ú-Í∏∞ÌÉÄ\"].some(k => c.includes(k))) return \"Í≥µÏó∞\";\r\n  if (c.includes(\"Ï†ÑÏãú/ÎØ∏Ïà†\")) return \"Ï†ÑÏãú\";\r\n  if (c.includes(\"ÍµêÏú°/Ï≤¥Ìóò\") || String(themecode).includes(\"ÍµêÏú°\")) return \"ÍµêÏú°/Ï≤¥Ìóò\";\r\n  return \"Í∏∞ÌÉÄ\";\r\n}\r\n\r\n/* === ÎÇ†Ïßú Ïú†Ìã∏ === */\r\nconst ymd = (d) => {\r\n  const y = d.getFullYear();\r\n  const m = String(d.getMonth() + 1).padStart(2, \"0\");\r\n  const day = String(d.getDate()).padStart(2, \"0\");\r\n  return `${y}-${m}-${day}`;\r\n};\r\nconst parseToDate = (s = \"\") => {\r\n  if (!s) return null;\r\n  const raw = String(s).trim();\r\n  if (/^\\d{8}$/.test(raw)) {\r\n    const y = raw.slice(0, 4), m = raw.slice(4, 6), d = raw.slice(6, 8);\r\n    const dt = new Date(`${y}-${m}-${d}T00:00:00`);\r\n    return isNaN(dt) ? null : dt;\r\n  }\r\n  const normalized = raw.replaceAll(\".\", \"-\");\r\n  const dt = new Date(normalized);\r\n  return isNaN(dt) ? null : dt;\r\n};\r\nconst normalizeRangeLabel = (s = \"\", e = \"\") => {\r\n  const S = (s || \"\").replaceAll(\".\", \"-\");\r\n  const E = (e || \"\").replaceAll(\".\", \"-\");\r\n  if (!S && !E) return \"ÏùºÏ†ï ÎØ∏Ï†ï\";\r\n  if (S && E) return `${S} ~ ${E}`;\r\n  return S || E;\r\n};\r\n\r\n/* === API ‚Üí Ïï±Ïö© Ïù¥Î≤§Ìä∏ Ï†ïÍ∑úÌôî(Ï¢åÌëúÎäî ÎÇòÏ§ëÏóê Ï±ÑÏõÄ) === */\r\nfunction normalizeEvents(json) {\r\n  const rows = json?.culturalEventInfo?.row || [];\r\n  return rows.map((r, idx) => {\r\n    const startStr = r.STRTDATE || r.DATE;\r\n    const endStr = r.END_DATE || r.ENDDATE || r.END;\r\n    const start = parseToDate(startStr);\r\n    const end = parseToDate(endStr) || start;\r\n    const category = toHighLevelCategory(r.CODENAME, r.THEMECODE);\r\n\r\n    return {\r\n      id: r.SVCID || `evt_${idx}`,\r\n      title: r.TITLE || r.SVCNM || \"Î¨¥Ï†ú\",\r\n      category,\r\n      place: r.PLACE || \"\",\r\n      gu: r.GUNAME || \"\",\r\n      dateStart: start ? ymd(start) : \"\",\r\n      dateEnd: end ? ymd(end) : \"\",\r\n      dateLabel: normalizeRangeLabel(startStr, endStr),\r\n      homepage: r.ORG_LINK || r.HMPG_ADDR || \"\",\r\n      fee: r.USE_FEE || \"\",\r\n      lat: null,\r\n      lng: null,\r\n    };\r\n  });\r\n}\r\n\r\n/* === Ï¢åÌëú Ï∫êÏãú(localStorage) === */\r\nconst LS_GEO = \"sn_geo_cache_v1\";\r\nconst loadGeoCache = () => { try { return JSON.parse(localStorage.getItem(LS_GEO) || \"{}\"); } catch { return {}; } };\r\nconst saveGeoCache = (obj) => localStorage.setItem(LS_GEO, JSON.stringify(obj));\r\n\r\n/* === ÎÇ†Ïßú ÌïÑÌÑ∞ === */\r\nconst inRange = (ev, startISO, endISO) => {\r\n  if (!startISO && !endISO) return true;\r\n  const s = ev.dateStart ? new Date(ev.dateStart + \"T00:00:00\") : null;\r\n  const e = ev.dateEnd ? new Date(ev.dateEnd + \"T23:59:59\") : s;\r\n  const S = startISO ? new Date(startISO + \"T00:00:00\") : null;\r\n  const E = endISO ? new Date(endISO + \"T23:59:59\") : null;\r\n  if (!s || !e) return false;\r\n  const leftOK = !E || s <= E;\r\n  const rightOK = !S || e >= S;\r\n  return leftOK && rightOK;\r\n};\r\n\r\n// ÏÑúÏö∏Ïãú ÎåÄÎûµÏ†ÅÏù∏ Í≤ΩÍ≥Ñ (ÏßÄÏò§ÏΩîÎî© Í≤∞Í≥º ÌïÑÌÑ∞ÎßÅÏö©)\r\nconst isWithinSeoulBoundary = (lat, lng) => {\r\n  return lat >= 37.4 && lat <= 37.7 && lng >= 126.7 && lng <= 127.2;\r\n};\r\n\r\nexport default function MapPage() {\r\n  /* ÌïÑÌÑ∞ ÏÉÅÌÉú */\r\n  const [category, setCategory] = useState(\"Ï†ÑÏ≤¥\");\r\n  const [area, setArea] = useState(\"Ï†ÑÏ≤¥\");\r\n  const [quick, setQuick] = useState(\"Ïò§Îäò\");\r\n  const [startDate, setStartDate] = useState(ymd(new Date())); // Í∏∞Î≥∏: Ïò§Îäò\r\n  const [endDate, setEndDate] = useState(\"\");\r\n\r\n  /* Îç∞Ïù¥ÌÑ∞/ÏßÄÎèÑ ÏÉÅÌÉú */\r\n  const [events, setEvents] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [err, setErr] = useState(null);\r\n  const [selected, setSelected] = useState(null);\r\n\r\n  const mapEl = useRef(null);\r\n  const mapRef = useRef(null);\r\n  const markersRef = useRef([]);\r\n  const infoRef = useRef([]);\r\n  const clusterRef = useRef(null);\r\n  const kakaoRef = useRef(null);\r\n\r\n  /* Kakao + Îç∞Ïù¥ÌÑ∞ Î°úÎìú */\r\n  useEffect(() => {\r\n    let disposed = false;\r\n\r\n    (async () => {\r\n      try {\r\n        const kakao = await loadKakao();\r\n        if (disposed) return;\r\n        kakaoRef.current = kakao;\r\n\r\n        const center = new kakao.maps.LatLng(37.5665, 126.9780);\r\n        if (mapEl.current) {\r\n          const map = new kakao.maps.Map(mapEl.current, { center, level: 7 });\r\n          mapRef.current = map;\r\n        }\r\n\r\n        setLoading(true);\r\n        setErr(null);\r\n\r\n        if (!SEOUL_API_BASE) {\r\n          throw new Error(\"REACT_APP_SEOUL_KEYÍ∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§ (.env ÌôïÏù∏).\");\r\n        }\r\n\r\n        const userStartISO = startDate || ymd(new Date());\r\n        const userStart = new Date(userStartISO + \"T00:00:00\");\r\n\r\n        let pageStart = 1;\r\n        const allRows = [];\r\n        let stop = false;\r\n\r\n        while (!stop) {\r\n          const pageEnd = pageStart + PAGE_SIZE - 1;\r\n          const url = `${SEOUL_API_BASE}/${pageStart}/${pageEnd}/`;\r\n\r\n          const res = await fetch(url, { cache: \"no-store\" });\r\n          if (!res.ok) throw new Error(`HTTP ${res.status}`);\r\n\r\n          const json = await res.json();\r\n          const rows = json?.culturalEventInfo?.row || [];\r\n\r\n          if (rows.length === 0) break;\r\n\r\n          allRows.push(...rows);\r\n\r\n          const last = rows[rows.length - 1];\r\n          const endStr =\r\n            last.END_DATE ||\r\n            last.ENDDATE ||\r\n            last.END ||\r\n            last.STRTDATE ||\r\n            last.DATE;\r\n          const lastEnd = parseToDate(endStr);\r\n\r\n          if (lastEnd && lastEnd < userStart) {\r\n            stop = true;\r\n          } else {\r\n            pageStart += PAGE_SIZE;\r\n          }\r\n\r\n          if (disposed) return;\r\n        }\r\n\r\n        const items = normalizeEvents({\r\n          culturalEventInfo: { row: allRows },\r\n        });\r\n\r\n        if (!disposed) setEvents(items);\r\n      } catch (e) {\r\n        if (!disposed) setErr(e);\r\n      } finally {\r\n        if (!disposed) setLoading(false);\r\n      }\r\n    })();\r\n\r\n    return () => {\r\n      disposed = true;\r\n    };\r\n  }, [startDate]);\r\n\r\n  /* Îπ†Î•∏ Í∏∞Í∞Ñ ÏÑ†ÌÉù */\r\n  useEffect(() => {\r\n    if (!quick) return;\r\n\r\n    const today = new Date();\r\n\r\n    if (quick === \"Ïò§Îäò\") {\r\n      const k = ymd(today);\r\n      setStartDate(k);\r\n      setEndDate(k);\r\n      return;\r\n    }\r\n\r\n    if (quick === \"Ïù¥Î≤à Ï£º\") {\r\n      const day = today.getDay(); // 0:Ïùº\r\n      const diffToMon = day === 0 ? -6 : 1 - day;\r\n      const mon = new Date(today); mon.setDate(today.getDate() + diffToMon);\r\n      const sun = new Date(mon);   sun.setDate(mon.getDate() + 6);\r\n      setStartDate(ymd(mon));\r\n      setEndDate(ymd(sun));\r\n      return;\r\n    }\r\n\r\n    if (quick === \"Ïù¥Î≤à Îã¨\") {\r\n      const y = today.getFullYear(), m = today.getMonth();\r\n      const s = new Date(y, m, 1);\r\n      const e = new Date(y, m + 1, 0);\r\n      setStartDate(ymd(s));\r\n      setEndDate(ymd(e));\r\n      return;\r\n    }\r\n  }, [quick]);\r\n\r\n  /* ÏßÄÏó≠ Î≥ÄÍ≤Ω ‚Üí ÏßÄÎèÑ Ï§ëÏã¨ Ïù¥Îèô */\r\n  useEffect(() => {\r\n    const kakao = kakaoRef.current;\r\n    const map = mapRef.current;\r\n    if (!kakao || !map) return;\r\n    if (area === \"Ï†ÑÏ≤¥\") {\r\n      map.setLevel(7);\r\n      map.setCenter(new kakao.maps.LatLng(37.5665, 126.9780));\r\n    } else if (GU_CENTER[area]) {\r\n      const [lat, lng] = GU_CENTER[area];\r\n      map.setLevel(5);\r\n      map.setCenter(new kakao.maps.LatLng(lat, lng));\r\n    } else {\r\n      const ps = new kakao.maps.services.Places();\r\n      ps.keywordSearch(area, (data, status) => {\r\n        if (status === kakao.maps.services.Status.OK && data[0]) {\r\n          map.setLevel(5);\r\n          map.setCenter(new kakao.maps.LatLng(data[0].y, data[0].x));\r\n        }\r\n      });\r\n    }\r\n  }, [area]);\r\n\r\n  /* ÌïÑÌÑ∞ÎßÅ */\r\n  const filtered = useMemo(() => {\r\n    return events.filter((e) => {\r\n      const byCat = category === \"Ï†ÑÏ≤¥\" ? true : e.category === category;\r\n      const byArea = area === \"Ï†ÑÏ≤¥\" ? true : (e.gu?.includes(area) || e.place?.includes(area));\r\n      const byDate = inRange(e, startDate, endDate);\r\n      return byCat && byArea && byDate;\r\n    });\r\n  }, [events, category, area, startDate, endDate]);\r\n\r\n  /* Ïû•ÏÜå ‚Üí Ï¢åÌëú(ÏßÄÏò§ÏΩîÎî©) + Ï∫êÏãú */\r\n  const [geoReadyEvents, setGeoReadyEvents] = useState([]);\r\n  useEffect(() => {\r\n    const kakao = kakaoRef.current;\r\n    if (!kakao) return;\r\n\r\n    const cache = loadGeoCache();\r\n    const ps = new kakao.maps.services.Places();\r\n    const geocoder = new kakao.maps.services.Geocoder();\r\n\r\n    let cancelled = false;\r\n\r\n    const SEOUL_CENTER = new kakao.maps.LatLng(37.5665, 126.9780);\r\n    const isBadPlace = (txt = \"\") => {\r\n      const s = String(txt);\r\n      return !s.trim() || /Ïò®ÎùºÏù∏|ÎπÑÎåÄÎ©¥|Î¨¥Í¥Ä|ÎØ∏Ï†ï|ÏóÜÏùå/i.test(s);\r\n    };\r\n    const pickSeoulHit = (data, gu) => {\r\n      const inSeoul = data.filter(d => (d.address_name || \"\").startsWith(\"ÏÑúÏö∏\"));\r\n      const inGu = gu ? inSeoul.filter(d => d.address_name.includes(gu)) : inSeoul;\r\n      return (inGu[0] || inSeoul[0] || null);\r\n    };\r\n\r\n    const fillCoords = async () => {\r\n      const targets = filtered.slice(0, 300);\r\n      const out = [];\r\n      for (const ev of targets) {\r\n        const key = `${ev.gu || \"\"}|${ev.place || \"\"}|${ev.title}`;\r\n        if (cache[key]) { out.push({ ...ev, ...cache[key] }); continue; }\r\n\r\n        let coords = null;\r\n\r\n        // 0) PLACEÍ∞Ä ÏßÄÏò§ÏΩîÎî© Î∂ÄÏ†ÅÌï©Ïù¥Î©¥ Î∞îÎ°ú Íµ¨ Ï§ëÏã¨\r\n        if (isBadPlace(ev.place) && GU_CENTER[ev.gu]) {\r\n          const [lat, lng] = GU_CENTER[ev.gu];\r\n          coords = { lat, lng };\r\n        }\r\n\r\n        // 1) ÌÇ§ÏõåÎìú Í≤ÄÏÉâ (Íµ¨Î™Ö + Ïû•ÏÜå)\r\n        if (!coords && ev.place) {\r\n          const query = `${ev.gu ? ev.gu + \" \" : \"\"}${ev.place}`.trim();\r\n          coords = await new Promise(resolve => {\r\n            ps.keywordSearch(\r\n              query,\r\n              (data, status) => {\r\n                if (status === kakao.maps.services.Status.OK && data.length) {\r\n                  const best = pickSeoulHit(data, ev.gu);\r\n                  if (best) return resolve({ lat: Number(best.y), lng: Number(best.x) });\r\n                }\r\n                resolve(null);\r\n              },\r\n              { location: SEOUL_CENTER, radius: 60000 }\r\n            );\r\n          });\r\n        }\r\n\r\n        // 2) Ï£ºÏÜå ÏßÄÏò§ÏΩîÎî© (ÏÑúÏö∏/Íµ¨ Í≤ÄÏ¶ù)\r\n        if (!coords && ev.place) {\r\n          coords = await new Promise(resolve => {\r\n            geocoder.addressSearch(ev.place, (result, status) => {\r\n              if (status === kakao.maps.services.Status.OK && result[0]) {\r\n                const r = result.find(r => r.address_name.startsWith(\"ÏÑúÏö∏\") && (!ev.gu || r.address_name.includes(ev.gu))) || result[0];\r\n                if (r.address_name.startsWith(\"ÏÑúÏö∏\")) {\r\n                  return resolve({ lat: Number(r.y), lng: Number(r.x) });\r\n                }\r\n              }\r\n              resolve(null);\r\n            });\r\n          });\r\n        }\r\n\r\n        // 3) ÏµúÏ¢Ö Î≥¥Í∞ï: Íµ¨ Ï§ëÏã¨\r\n        if (!coords && GU_CENTER[ev.gu]) {\r\n          const [lat, lng] = GU_CENTER[ev.gu];\r\n          coords = { lat, lng };\r\n        }\r\n\r\n        // ÏÑúÏö∏ Í≤ΩÍ≥Ñ Í≤ÄÏ¶ù\r\n        if (coords) {\r\n          if (!isWithinSeoulBoundary(coords.lat, coords.lng)) {\r\n            console.warn(`[Î≤îÏúÑ Ïò§Î•ò] ÏÑúÏö∏ Î∞ñ Ï¢åÌëú Í∞êÏßÄ: ${ev.title}`, coords);\r\n            if (GU_CENTER[ev.gu]) {\r\n              const [lat, lng] = GU_CENTER[ev.gu];\r\n              coords = { lat, lng };\r\n            } else {\r\n              coords = null;\r\n            }\r\n          }\r\n        }\r\n\r\n        if (coords) {\r\n          cache[key] = coords;\r\n          out.push({ ...ev, ...coords });\r\n        }\r\n\r\n        await new Promise(r => setTimeout(r, 25));\r\n        if (cancelled) return;\r\n      }\r\n      saveGeoCache(cache);\r\n      if (!cancelled) setGeoReadyEvents(out);\r\n    };\r\n\r\n    fillCoords();\r\n    return () => { cancelled = true; };\r\n  }, [filtered]);\r\n\r\n  /* ÎßàÏª§/ÌÅ¥Îü¨Ïä§ÌÑ∞ Í∞±Ïã† + ÏßÄÎèÑ ÌÅ¥Î¶≠ Ïãú ÌåùÏóÖ Îã´Í∏∞ */\r\n  useEffect(() => {\r\n    const kakao = kakaoRef.current;\r\n    const map = mapRef.current;\r\n    if (!kakao || !map) return;\r\n\r\n    // Í∏∞Ï°¥ ÎßàÏª§/Ïù∏Ìè¨ÏúàÎèÑÏö∞/ÌÅ¥Îü¨Ïä§ÌÑ∞ Ï†úÍ±∞\r\n    markersRef.current.forEach((m) => m.setMap(null));\r\n    infoRef.current.forEach((i) => i.close());\r\n    markersRef.current = [];\r\n    infoRef.current = [];\r\n    if (clusterRef.current) clusterRef.current.clear();\r\n\r\n    if (geoReadyEvents.length === 0) return;\r\n\r\n    const markers = [];\r\n    const infos = [];\r\n    const bounds = new kakao.maps.LatLngBounds();\r\n\r\n    geoReadyEvents.forEach((ev) => {\r\n      if (ev.lat == null || ev.lng == null) return;\r\n      const pos = new kakao.maps.LatLng(ev.lat, ev.lng);\r\n      bounds.extend(pos);\r\n\r\n      const marker = new kakao.maps.Marker({ position: pos, title: ev.title });\r\n      const iwHtml = `\r\n        <div style=\"padding:8px 10px; font-size:12px; max-width:240px;\">\r\n          <div style=\"font-weight:600; margin-bottom:4px;\">${ev.title}</div>\r\n          <div style=\"color:#666;\">${ev.place || ev.gu || \"\"}</div>\r\n          <div style=\"color:#888; margin-top:2px;\">${ev.dateLabel}</div>\r\n        </div>\r\n      `;\r\n      const iw = new kakao.maps.InfoWindow({\r\n        content: iwHtml,\r\n        removable: true, // ‚òÖ X Î≤ÑÌäº ÌëúÏãú\r\n      });\r\n\r\n      kakao.maps.event.addListener(marker, \"click\", () => {\r\n        infos.forEach((i) => i.close());\r\n        iw.open(map, marker);\r\n        setSelected(ev);\r\n      });\r\n\r\n      markers.push(marker);\r\n      infos.push(iw);\r\n    });\r\n\r\n    markersRef.current = markers;\r\n    infoRef.current = infos;\r\n\r\n    const clusterer = new kakao.maps.MarkerClusterer({\r\n      map,\r\n      markers,\r\n      averageCenter: true,\r\n      minLevel: 6,\r\n      disableClickZoom: false,\r\n    });\r\n    clusterRef.current = clusterer;\r\n\r\n    // ‚òÖ ÏßÄÎèÑ Îã§Î•∏ Î∂ÄÎ∂Ñ ÌÅ¥Î¶≠ Ïãú Î™®Îì† Î†àÏù¥Ïñ¥ ÌåùÏóÖ Îã´Í∏∞\r\n    const handleMapClick = () => {\r\n      infos.forEach((i) => i.close());\r\n    };\r\n    kakao.maps.event.addListener(map, \"click\", handleMapClick);\r\n\r\n    if (area === \"Ï†ÑÏ≤¥\" && markers.length > 0) {\r\n      map.setBounds(bounds, 40, 40, 40, 40);\r\n    }\r\n    if (selected && !geoReadyEvents.some((e) => e.id === selected.id)) {\r\n      setSelected(null);\r\n    }\r\n\r\n    return () => {\r\n      kakao.maps.event.removeListener(map, \"click\", handleMapClick);\r\n    };\r\n  }, [geoReadyEvents, area, selected]);\r\n\r\n  /* Ï¶êÍ≤®Ï∞æÍ∏∞ ÌÜ†Í∏Ä (ÌéòÏù¥ÏßÄ Ïù¥Îèô ÏóÜÏùå) */\r\n  const [, forceFav] = useState(0);\r\n  const onToggleFav = (ev) => {\r\n    toggleFav({\r\n      id: ev.id,\r\n      title: ev.title,\r\n      category: ev.category,\r\n      date: ev.dateLabel,\r\n      place: ev.place || ev.gu || \"\",\r\n      homepage: ev.homepage || \"\",\r\n    });\r\n    forceFav((v) => v + 1);\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-white px-6 py-8 max-w-7xl mx-auto\">\r\n      <div className=\"grid grid-cols-1 lg:grid-cols-12 gap-6\">\r\n        {/* ÏôºÏ™Ω Ï†úÏñ¥ Ìå®ÎÑê */}\r\n        <aside className=\"lg:col-span-3\">\r\n          <h2 className=\"font-semibold mb-2\">Ïπ¥ÌÖåÍ≥†Î¶¨</h2>\r\n          <select\r\n            value={category}\r\n            onChange={(e) => setCategory(e.target.value)}\r\n            className=\"border rounded px-2 py-2 w-full mb-4\"\r\n          >\r\n            {CATEGORIES.map((c) => <option key={c} value={c}>{c}</option>)}\r\n          </select>\r\n\r\n          <h2 className=\"font-semibold mb-2\">ÏßÄÏó≠(ÌñâÏ†ïÍµ¨)</h2>\r\n          <select\r\n            value={area}\r\n            onChange={(e) => setArea(e.target.value)}\r\n            className=\"border rounded px-2 py-2 w-full mb-4\"\r\n          >\r\n            {AREAS.map((a) => <option key={a} value={a}>{a}</option>)}\r\n          </select>\r\n\r\n          <h2 className=\"font-semibold mb-2\">ÎÇ†Ïßú</h2>\r\n          <div className=\"grid grid-cols-3 gap-2 mb-2\">\r\n            {QUICK_RANGES.map((r) => (\r\n              <button\r\n                key={r}\r\n                onClick={() => setQuick(r)}\r\n                className={\r\n                  \"text-xs border rounded px-2 py-1 \" +\r\n                  (quick === r ? \"bg-black text-white\" : \"bg-white hover:bg-gray-50\")\r\n                }\r\n              >\r\n                {r}\r\n              </button>\r\n            ))}\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <input\r\n              type=\"date\"\r\n              value={startDate}\r\n              onChange={(e) => { setStartDate(e.target.value); setQuick(\"\"); }}\r\n              className=\"border rounded px-2 py-1 text-sm w-full\"\r\n            />\r\n            <span className=\"text-sm text-gray-500\">~</span>\r\n            <input\r\n              type=\"date\"\r\n              value={endDate}\r\n              onChange={(e) => { setEndDate(e.target.value); setQuick(\"\"); }}\r\n              className=\"border rounded px-2 py-1 text-sm w-full\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"mt-4 text-xs text-gray-600\">\r\n            {loading ? \"üîÑ ÏÑúÏö∏Ïãú ÌñâÏÇ¨ Î∂àÎü¨Ïò§Îäî Ï§ë‚Ä¶\" : `ÌëúÏãú ÌõÑÎ≥¥: ${filtered.length}Í±¥`}\r\n            {err && <div className=\"text-red-600 mt-1\">Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®: {String(err.message || err)}</div>}\r\n          </div>\r\n        </aside>\r\n\r\n        {/* ÏßÄÎèÑ */}\r\n        <section className=\"lg:col-span-6\">\r\n          <div\r\n            ref={mapEl}\r\n            className=\"border rounded-lg w-full\"\r\n            style={{ height: 600 }}\r\n            aria-label=\"Ïπ¥Ïπ¥Ïò§ ÏßÄÎèÑ\"\r\n            role=\"region\"\r\n          />\r\n        </section>\r\n\r\n        {/* ÏÉÅÏÑ∏ Ìå®ÎÑê */}\r\n        <aside className=\"lg:col-span-3 border rounded-lg p-4 bg-gray-50\">\r\n          {!selected ? (\r\n            <div className=\"text-gray-500 text-sm text-center mt-20\">\r\n              ÏßÄÎèÑÏùò ÎßàÏª§Î•º ÌÅ¥Î¶≠ÌïòÎ©¥ ÏÉÅÏÑ∏ Ï†ïÎ≥¥Í∞Ä ÌëúÏãúÎê©ÎãàÎã§.\r\n            </div>\r\n          ) : (\r\n            <div>\r\n              <div className=\"text-xs inline-flex items-center rounded-full bg-gray-200 px-2 py-0.5 mb-2\">\r\n                {selected.category} {selected.gu ? `¬∑ ${selected.gu}` : \"\"}\r\n              </div>\r\n              <h3 className=\"font-bold text-lg mb-1\">{selected.title}</h3>\r\n              <p className=\"text-sm text-gray-700\">{selected.place || selected.gu || \"\"}</p>\r\n              <p className=\"text-sm text-gray-700 mt-1\">üìÖ {selected.dateLabel}</p>\r\n              {selected.fee && <p className=\"text-xs text-gray-500 mt-1\">ÏöîÍ∏à: {selected.fee}</p>}\r\n\r\n              <div className=\"mt-3 flex items-center gap-3\">\r\n                <button\r\n                  onClick={() => onToggleFav(selected)}\r\n                  className=\"text-xl\"\r\n                  title={isFav(selected.id) ? \"Ï¶êÍ≤®Ï∞æÍ∏∞ Ìï¥Ï†ú\" : \"Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä\"}\r\n                  aria-label={isFav(selected.id) ? \"Ï¶êÍ≤®Ï∞æÍ∏∞ Ìï¥Ï†ú\" : \"Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä\"}\r\n                >\r\n                  {isFav(selected.id) ? \"‚ù§Ô∏è\" : \"ü§ç\"}\r\n                </button>\r\n                {selected.homepage && (\r\n                  <a\r\n                    href={selected.homepage}\r\n                    target=\"_blank\"\r\n                    rel=\"noreferrer\"\r\n                    className=\"text-sm underline\"\r\n                    title=\"ÏÉÅÏÑ∏Î≥¥Í∏∞\"\r\n                  >\r\n                    ÏÉÅÏÑ∏Î≥¥Í∏∞\r\n                  </a>\r\n                )}\r\n              </div>\r\n\r\n              <button\r\n                className=\"mt-4 text-xs underline text-gray-600\"\r\n                onClick={() => setSelected(null)}\r\n              >\r\n                ÏÑ†ÌÉù Ìï¥Ï†ú\r\n              </button>\r\n            </div>\r\n          )}\r\n        </aside>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}